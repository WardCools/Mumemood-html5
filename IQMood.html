<!DOCTYPE html> 
<html> 
<head> 
	<title>IQMood</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<!--meta http-equiv="refresh" content="5"/--> 
	<!--link rel="stylesheet" href="style/jquery.mobile-1.2.0.min.css" /-->
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<link rel="stylesheet" type="text/css" href="style/main.css"></link>
	<script language="Javascript" type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
	<!--script language="Javascript" type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.min.js"></script-->
	<script language="Javascript" type="text/javascript" src="js/jquery.mobile-1.2.0.min.js"></script>
	<!--script language="Javascript" type="text/javascript" src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.js"></script-->
	<script language="Javascript" type="text/javascript" src="js/jquery.lwtCountdown-1.0.js"></script>
	<!--script language="Javascript" type="text/javascript" src="http://www.littlewebthings.com/projects/countdown/demo/js/jquery.lwtCountdown-1.0.js"></script-->
	<script language="Javascript" type="text/javascript" src="js/misc.js"></script>
	<script src="js/d3.v2.js"></script>
	<style type='text/css'>
		/*Sets the slider label position*/
		.slider-label {
			position:fixed;
		}
		/*Sets the icon images*/
		.ui-icon-statistics{
			background-image: url('images/16-line-chart.png');
		}
		
		/*Sets the axis settings*/
		.axis path,
		.axis line {
		    fill: none;
		    stroke: black;
		    shape-rendering: crispEdges;
		}
		.axis text {
		    font-family: sans-serif;
		    font-size: 11px;
		}
	</style>
	<script language="javascript" type="text/javascript">
	
		//Save the riddles
		localStorage.setItem("riddle_0", "images/usa3.jpg");
		localStorage.setItem("riddle_1", "images/india.jpg");
		localStorage.setItem("riddle_2", "images/france.jpg")
		localStorage.setItem("riddle_3", "images/uk.jpg");
		//Save the possible answers
		localStorage.setItem("answer_00", "USA");
		localStorage.setItem("answer_01", "Russia");
		localStorage.setItem("answer_02", "Alaska");
		localStorage.setItem("answer_03", "Belgium");
		localStorage.setItem("answer_10", "India");
		localStorage.setItem("answer_11", "Russia");
		localStorage.setItem("answer_12", "China");
		localStorage.setItem("answer_13", "Pakistan");
		localStorage.setItem("answer_20", "France");
		localStorage.setItem("answer_21", "Netherlands");
		localStorage.setItem("answer_22", "Germany");
		localStorage.setItem("answer_23", "UK");
		localStorage.setItem("answer_30", "UK");
		localStorage.setItem("answer_31", "China");
		localStorage.setItem("answer_32", "Spain");
		localStorage.setItem("answer_33", "Mexico");
		//Counter for saving the emotions
		var counter = 2;
		//Array that contains all the data
		var dataset = new Array();
		//Storing some test data	
		localStorage.setItem("happy_sad_0", 40);
		localStorage.setItem("relaxed_stressed_0", 70);
		localStorage.setItem("energetic_slow_ 0", 75);
		localStorage.setItem("confident_insecure_0", 55);
		localStorage.setItem("riddletime_0", 10);	
		localStorage.setItem("happy_sad_1", 20);
		localStorage.setItem("relaxed_stressed_1", 65);
		localStorage.setItem("energetic_slow_ 1", 40);
		localStorage.setItem("confident_insecure_1", 30);
		localStorage.setItem("riddletime_1", 75);
		
		//Script for saving the birthyear and sex
		$('#properties').live('pagecreate', function() {
			$('#prop_go').click(function() {
				localStorage.setItem("birthyear", $('#birthyear').val())
				if($('#radio-choice-m').is(':checked')){
					localStorage.setItem("sex", $('#radio-choice-m').val());
				}
				else if ($('#radio-choice-f').is(':checked')){
					localStorage.setItem("sex", $('#radio-choice-f').val());
				}
			});
	       });
	       
	       //Script for saving the emotions
	       $('#emotionspage').live('pagecreate', function() {
			$('#saveemotions').click(function() {
				localStorage.setItem("happy_sad_" + counter, $('#slider-1').val());
				localStorage.setItem("relaxed_stressed_" + counter, $('#slider-2').val());
				localStorage.setItem("energetic_slow_ " + counter, $('#slider-3').val());
				localStorage.setItem("confident_insecure_" + counter, $('#slider-4').val());
				localStorage.setItem("riddletime_" + counter, 20);
				counter ++;
				new_riddle();
			});
	       });
	       
	       //Script for putting the sliderlabels in the right position
	       //$(window).load(function() {
		$('#emotionspage').ready(function() { 
			var offset,
			$slider = null,
			dims = {
				top: null,
				left: null
			};
			$(".slider-label").each(function() {
				var $this = $(this);
				$slider = $this.prevAll("div.ui-slider[role='application']");
				if ( $this.hasClass("left") ) {
					offset = $slider.offset();
					dims.top = offset.top + $slider.outerHeight();
					dims.left = offset.left - 20;
				}
				if ( $this.hasClass("right") ) {
					dims.left += 2*20 + $slider.innerWidth() - $this.innerWidth();
				}
				$this.css( dims );
			});
		});
			       
	       //Function that creates a new riddle
	       function new_riddle(){
			var ranNumber = Math.round(Math.random() * 3);
			localStorage.setItem("aaaaaaaaaa", ranNumber);
			get_image(ranNumber);
			set_answers(ranNumber);
			set_countdown();
	       }
	       
	       //Function that initialises the countdown timer
		function set_countdown() {
			$('#countdown_dashboard').countDown({
				targetOffset: {
					'day': 	0,
					'month': 	0,
					'year': 	0,
					'hour': 	0,
					'min': 	0,
					'sec': 	5
				}//,
				//onComplete: riddle_good()
			});
		} 
	       
	       //Function that loads the riddle image (n is the number of the riddle)
	       function get_image(n){
			var image = localStorage.getItem("riddle_" + n);
			$('#riddle_image').attr("src",image);
	       }
	       
	       //Function that loads the answers for the riddle and puts that in a random order
	       function set_answers(n){
			var k = Math.round(Math.random() * 3);
			localStorage.setItem("choice_a", k);
			var second = (k+2)%4;
			localStorage.setItem("choice_b", second);
			var third = (k+1)%4;
			localStorage.setItem("choice_c", third);
			var forth = (k+3)%4;
			localStorage.setItem("choice_d", forth);
			var answer_a = localStorage.getItem("answer_" + n + k);
			$('#answer_a').text(answer_a);
			var answer_b = localStorage.getItem("answer_" + n + second);
			$('#answer_b').text(answer_b);
			var answer_c = localStorage.getItem("answer_" + n + third);
			$('#answer_c').text(answer_c);
			var answer_d = localStorage.getItem("answer_" + n + forth);
			$('#answer_d').text(answer_d);
	       }
	       
	       //Function that pauses the countdown timer
		function stop_time() {
			$('#countdown_dashboard').stopCountDown();
		}
		
		//Function that starts the countdown timer
		function start_time() {
			$('#countdown_dashboard').startCountDown();
		}
		
		//Function that restarts the countdown timer
		function restart_time() {
			$('#countdown_dashboard').stopCountDown();
			$('#countdown_dashboard').setCountDown({
				targetOffset: {
					'day': 	0,
					'month': 	0,
					'year': 	0,
					'hour': 	0,
					'min': 	0,
					'sec': 	5
				}
			});
			$('#countdown_dashboard').startCountDown();
		}
		
		//Function that checks wether the answer was good or bad
		function check_answer(n){
			var check = localStorage.getItem("choice_" + n);
			if(check == 0) {
				answer_good();
				
			} 
			else{
				answer_bad();
			}
		}
		
		//Function that alerts the user when he solved the riddle
		function answer_good(){
			alert("Champ!");
		}
		//Function that alerts the user when he choose a wrong answer
		function answer_bad(){
			alert("Loser!");
		}
		
		//Function that loads the stats and the graph
		function create_stats(){
			get_data();
			create_graph();
		}
		//Function that puts all the collected data in the dataset array
		function get_data(){
			for (j=0; j<counter; j++){
				dataset[j] = new Array();
				dataset[j][0] = localStorage.getItem("happy_sad_" + j);
				dataset[j][1] = localStorage.getItem("relaxed_stressed_" + j);
				dataset[j][2] = localStorage.getItem("energetic_slow_ " + j);
				dataset[j][3] = localStorage.getItem("confidentinsecure_" + j);
				dataset[j][4] = localStorage.getItem("riddletime_" + j);
			}
			localStorage.setItem("tester", dataset);
			localStorage.setItem("tester12", dataset[1][2]);
			localStorage.setItem("tester04", dataset[0][4]);
			localStorage.setItem("testerlkhl", (d3.max(dataset, function(d) { return d[4]; })));
		}
		
		//Function that creates the graph using d3
		function create_graph(){
			var w = 500;
			var h = 500;
		       var padding = 50; //Space between axes and dots
			var riddleScale = d3.scale.linear()
				.domain([0, ((d3.max(dataset, function(d) { return d[4]; })) + 20) ])
				.range([padding, w-padding*2]);
			var happysadScale = d3.scale.linear()
				.domain([0
				, ((d3.max(dataset, function(d) { return d[0]; })) + 20) ])
				.range([h-padding, padding]);
			var xAxis = d3.svg.axis()
				.scale(riddleScale)
				.orient("bottom")
				.ticks(10);
			var yAxis = d3.svg.axis()
				.scale(happysadScale)
				.orient("left")
				.ticks(10);
		       var svg = d3.select("#graph")
				.append("svg")
				.attr("width", 500)
				.attr("height", 500)
				.attr("align", "center");
			svg.selectAll("circle")
				.data(dataset)
				.enter()
				.append("circle")
				.attr("cx", function(d) {
					return riddleScale(d[4]);
				})
				.attr("cy", function(d) {
					return happysadScale(d[0]);
				})
				.attr("r", 10)
				.attr("fill", "black");
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (w - padding) + ")")
				.call(xAxis);
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
		}
	</script>
</head> 

<body> 

<div data-role="page" id="properties">

	<div data-role="header">
		<h1>IQMood</h1>
	</div>
	
	<div data-role="content">

		<div align="center">
			<img src="http://wdfyfe.files.wordpress.com/2012/07/puzzle11.jpg" alt="puzzle">
		</div>  
		
		<div align="center">
			<br>
			<legend>YEAR OF BIRTH</legend>
		</div>

		<div data-role="fieldcontain" align="center" valign="center">
			<!--fieldset data-role="controlgroup" data-type="horizontal">
				<legend>YEAR OF BIRTH</legend>
	    
				<label for="select-choice-era">era</label>
				<select name="select-choice-era" id="select-choice-era">
					<option value="19">19</option>
					<option value="20">20</option>
				</select>
	    
				<label for="select-choice-decade">decade</label>
				<select name="select-choice-decade" id="select-choice-decade">
					<option value="0">0</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
				</select>
		    
				<label for="select-choice-year">year</label>
				<select name="select-choice-year" id="select-choice-year">
					<option value="0">0</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
				</select>
        
			</fieldset-->
			<fieldset data-role="controlgroup" data-type="horizontal">
				
				<label for="birthyear" class="ui-hidden-accessible"></label>
				<input type="text" name="birthyear" id="birthyear" value=""  />
				
			</fieldset>
		</div>
		
		<div align="center" style="margin: 0 auto;">
			<br>
			<legend>SEX</legend>
		</div>
        
		<div data-role="fieldcontain" align="center" valign="center">
			<fieldset data-role="controlgroup" data-type="horizontal">
				<div style="width: 200px; margin: 0 auto;">

					
					<input type="radio" name="sex" id="radio-choice-m" value="male"/>
					<label for="radio-choice-m">Male</label>

					<input type="radio" name="sex" id="radio-choice-f" value="female"/>
					<label for="radio-choice-f">Female</label>
				
				</div>
			</fieldset>
		</div>
	</div>

	<div data-role="footer" class="ui-bar">
		<div data-role="navbar">
			<ul>
				<li><a href="#emotionspage" data-role="button" id="prop_go" data-icon="arrow-r" align="right" data-transition="slideup">GO!</a></li>
			</ul>
			
		</div>
	</div>

</div>

<div data-role="page" id="emotionspage">

	<div data-role="header">
		<h1>HOW ARE YOU?</h1>
	</div>

	<div data-role="content">	
		<div data-role="fieldcontain" class="ui-hide-label" align="center">
			<label for="slider-1"></label>
			<input type="range" name="slider-fill" style="display:none" id="slider-1" value="50" min="0" max="100" data-highlight="true" data-track-theme="b"/>
			<span class="slider-label left">HAPPY</span>
			<span class="slider-label right">SAD</span>
		</div>
		<br>
		<div data-role="fieldcontain" class="ui-hide-label" align="center">
			<label for="slider-2"></label>
			<input type="range" name="slider-fill" style="display:none" id="slider-2" value="50" min="0" max="100" data-highlight="true" data-track-theme="b"/>
			<span class="slider-label left">RELAXED</span>
			<span class="slider-label right">STRESSED</span>
		</div>
		<br>
		<div data-role="fieldcontain" class="ui-hide-label" align="center">
			<label for="slider-3"></label>
			<input type="range" name="slider-fill" style="display:none" id="slider-3" value="50" min="0" max="100" data-highlight="true" data-track-theme="b"/>
			<span class="slider-label left">ENERGETIC</span>
			<span class="slider-label right">SLOW</span>	
		</div>
		<br>
		<div data-role="fieldcontain" class="ui-hide-label" align="center">
			<label for="slider-4"></label>
			<input type="range" name="slider-fill" style="display:none" id="slider-4" value="50" min="0" max="100" data-highlight="true" data-track-theme="b"/>
			<span class="slider-label left">CONFIDENT</span>
			<span class="slider-label right">INSECURE</span>	
		</div>
		<br>	
		
	</div>

	<div data-role="footer" class="ui-bar">
		<div data-role="navbar">
			<ul>
				<li><a href="#properties" data-role="button" data-icon="gear" data-iconpos="notext">Properties</a></li>
				<li><a href="#statistics" onclick="create_stats()" data-role="button" data-icon="statistics" data-iconpos="notext">Statistics</a></li>
				<li><a href="#riddlepage" id="saveemotions" data-role="button" data-icon="arrow-r" data-iconpos="notext" align="right">Go!</a></li>
			</ul>
			
		</div>
	</div>

</div>

<div data-role="page" id="riddlepage">

	<div data-role="header">
		<h1>IQMood</h1>
	</div>
	
	<div data-role="content">
		<div align="center">
			<img id="riddle_image" src="fout" alt="A riddle should appear here...">
		</div> 
		
		<div class="ui-grid-a">
			<div class="ui-block-a">
				<a data-role="button" id="answer_a" onclick="check_answer('a')" data-icon="arrow-r" data-iconpos="right" ></a>
			</div>
			<div class="ui-block-b">
				<a data-role="button" id="answer_b" onclick="check_answer('b')" data-icon="arrow-r" data-iconpos="right" ></a>
			</div>
			<div class="ui-block-a">
				<a data-role="button" id="answer_c" onclick="check_answer('c')" data-icon="arrow-r"  data-iconpos="right" ></a>
			</div>
			<div class="ui-block-b">
				<a data-role="button" id="answer_d" onclick="check_answer('d')" data-icon="arrow-r" data-iconpos="right" ></a>
			</div>
		</div>
	
		<div id="container" data-role="fieldcontain" align="center">

			<div id="countdown_dashboard" align="center">
				<!--div class="dash weeks_dash">
					<span class="dash_title">weeks</span>
					<div class="digit"><div class="top" style="display: none; ">0</div><div class="bottom" style="display: block; ">0</div></div>
					<div class="digit"><div class="top" style="display: none; ">4</div><div class="bottom" style="display: block; ">4</div></div>
				</div>

				<div class="dash days_dash">
					<span class="dash_title">days</span>
					<div class="digit"><div class="top" style="display: none; ">0</div><div class="bottom" style="display: block; ">0</div></div>
					<div class="digit"><div class="top" style="display: none; ">4</div><div class="bottom" style="display: block; ">4</div></div>
				</div>

				<div class="dash hours_dash">
					<span class="dash_title">hours</span>
					<div class="digit"><div class="top" style="display: none; ">0</div><div class="bottom" style="display: block; ">0</div></div>
					<div class="digit"><div class="top" style="display: none; ">1</div><div class="bottom" style="display: block; ">1</div></div>
				</div-->

				<div class="dash minutes_dash">
					<span class="dash_title">minutes</span>
					<div class="digit"><div class="top" style="display: none; ">0</div><div class="bottom" style="display: block; ">0</div></div>
					<div class="digit"><div class="top" style="display: none; ">0</div><div class="bottom" style="display: block; ">0</div></div>
				</div>

				<div class="dash seconds_dash">
					<span class="dash_title">seconds</span>
					<div class="digit"><div class="top" style="display: none; ">0</div><div class="bottom" style="display: block; ">0</div></div>
					<div class="digit"><div class="top" style="display: none; ">0</div><div class="bottom" style="display: block; ">0</div></div>
				</div>
			</div>
			
			<div class="countdown_controls" data-role="controlgroup" data-type="horizontal">
				<button onclick="restart_time()">restart</button>
				<button onclick="start_time()">start</button>
				<button onclick="stop_time()">pause</button>
				<button onclick="new_riddle()">new riddle</button>
			</div>
			
		</div>
	</div>
	
	<div data-role="footer" class="ui-bar">
		<div data-role="navbar">
			<ul>
				<p>Text</p>
			</ul>
			
		</div>
	</div>
	
</div>

<div data-role="page" id="statistics">

	<div data-role="header">
		<h1>Statistics</h1>
	</div>

	<div data-role="content" id="graph" align="center" valign="center">
	</div>

	<div data-role="footer">
		<div data-role="navbar">
			<ul>
				<li><a href="#emotionspage" data-role="button" id="prop_go" data-icon="arrow-l" align="right">BACK</a></li>
			</ul>
			
		</div>
	</div>

</div>
 <!--script type="text/javascript">
       $('#startpage').live('pagecreate', function() {
		$('#saveemotions').click(function() {
			localStorage.setItem("test", $('#slider-1').val());
		});
       });
</script-->

</body>
</html>
